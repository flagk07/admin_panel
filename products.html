<ul id="productList"></ul>
<p>Всего товаров: <span id="productCount"></span></p>

<script>
  const supabase = window.supabase.createClient(
    'https://hsrqdpwzgcugnansawpl.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhzcnFkcHd6Z2N1Z25hbnNhd3BsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyNzgzNDMsImV4cCI6MjA2NDg1NDM0M30.8VhS4S3pYydvj3XDxKXp4AnkS3b90X0qkp9cwn4p3-8'
  );

  async function loadProductStats() {
    const { data: products, error } = await supabase
      .from('products')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) {
      console.error('Ошибка загрузки:', error);
      return;
    }

    document.getElementById('productCount').textContent = products.length;
    const list = document.getElementById('productList');
    list.innerHTML = '';

    products.forEach(p => {
      const li = document.createElement('li');
      const statusText = p.available ? '✅ В наличии' : '❌ Нет в наличии';
      const toggleButton = document.createElement('button');

      toggleButton.textContent = statusText;
      toggleButton.style.marginLeft = '10px';
      toggleButton.style.padding = '4px 8px';
      toggleButton.style.cursor = 'pointer';

      toggleButton.onclick = async () => {
        const newValue = !p.available;
        const { error: updateError } = await supabase
          .from('products')
          .update({ available: newValue })
          .eq('id', p.id);

        if (updateError) {
          alert('Ошибка обновления: ' + updateError.message);
        } else {
          loadProductStats();
        }
      };

      li.textContent = `${p.title} — ${p.category}, ${p.price}₽`;
      li.appendChild(toggleButton);
      list.appendChild(li);
    });
  }

  loadProductStats();
</script>
